<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FutureIntern API Tester - Complete</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            margin-bottom: 30px;
            text-align: center;
        }

        h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #7f8c8d;
            font-size: 1.1em;
        }

        .status-badge {
            display: inline-block;
            padding: 8px 16px;
            background: #27ae60;
            color: white;
            border-radius: 20px;
            font-weight: bold;
            margin-top: 10px;
        }

        .section {
            background: white;
            padding: 25px;
            margin: 20px 0;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .section:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        h2 {
            color: #3498db;
            border-bottom: 3px solid #3498db;
            padding-bottom: 12px;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .endpoint {
            margin: 15px 0;
            padding: 18px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-left: 5px solid #3498db;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .endpoint:hover {
            background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
            border-left-width: 8px;
        }

        .method {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 6px;
            font-weight: bold;
            margin-right: 10px;
            font-size: 0.85em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .get {
            background: #28a745;
            color: white;
        }

        .post {
            background: #007bff;
            color: white;
        }

        .put {
            background: #ffc107;
            color: #000;
        }

        .delete {
            background: #dc3545;
            color: white;
        }

        a {
            color: #3498db;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        a:hover {
            color: #2980b9;
            text-decoration: underline;
        }

        button {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        button:active {
            transform: translateY(0);
        }

        input,
        textarea,
        select {
            width: 100%;
            padding: 10px;
            margin: 8px 0;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #3498db;
        }

        .token-display {
            background: linear-gradient(135deg, #e8f4f8 0%, #d4e9f2 100%);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            word-break: break-all;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            border-left: 4px solid #3498db;
        }

        .response {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            border: 1px solid #333;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 500px;
            overflow-y: auto;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .response::-webkit-scrollbar {
            width: 10px;
        }

        .response::-webkit-scrollbar-track {
            background: #2d2d2d;
        }

        .response::-webkit-scrollbar-thumb {
            background: #555;
            border-radius: 5px;
        }

        .form-group {
            margin: 12px 0;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #2c3e50;
        }

        .info-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 6px;
            font-size: 14px;
        }

        .success-box {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 15px 0;
            border-radius: 6px;
            font-size: 14px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .highlight {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: bold;
        }

        .new-badge {
            background: #e74c3c;
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: bold;
            margin-left: 10px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>🚀 FutureIntern API Tester</h1>
            <p class="subtitle">Complete Backend Testing Interface - All 6 Phases</p>
            <span class="status-badge">✅ 100% Complete</span>
        </header>

        <div class="section">
            <h2>🛠️ Configuration</h2>
            <div class="success-box">
                <strong>Base URL:</strong> <a href="http://127.0.0.1:5000" target="_blank"
                    style="color: #2980b9; text-decoration: underline; font-weight: bold;">http://127.0.0.1:5000</a><br>
                <strong>Status:</strong> ✅ Server Running - All endpoints ready for testing
            </div>

            <div id="tokenInfo" class="token-display" style="display:none;">
                <strong>🔑 Active Token:</strong><br>
                <span id="tokenValue">None</span><br>
                <small id="userInfo" style="color: #555;"></small>
            </div>
        </div>

        <!-- Public Endpoints -->
        <div class="section">
            <h2>🌐 Public Endpoints</h2>

            <div class="endpoint">
                <span class="method get">GET</span>
                <strong>Root - API Info</strong><br>
                <a href="http://127.0.0.1:5000/" target="_blank"
                    style="color: #2980b9; text-decoration: underline;">http://127.0.0.1:5000/</a>
                <p style="margin-top: 10px; color: #666; font-size: 14px;">Root - API Info</p>
            </div>

            <div class="endpoint">
                <span class="method get">GET</span>
                <strong>Test Auth Endpoint</strong><br>
                <a href="http://127.0.0.1:5000/api/auth/" target="_blank"
                    style="color: #2980b9; text-decoration: underline;">http://127.0.0.1:5000/api/auth/</a>
                <p style="margin-top: 10px; color: #666; font-size: 14px;">Test Auth Endpoint</p>
            </div>

            <div class="endpoint">
                <span class="method get">GET</span>
                <strong>List All Internships</strong><br>
                <a href="http://127.0.0.1:5000/api/internships/" target="_blank"
                    style="color: #2980b9; text-decoration: underline;">http://127.0.0.1:5000/api/internships/</a>
                <p style="margin-top: 10px; color: #666; font-size: 14px;">List all internships</p>
            </div>

            <div class="endpoint">
                <span class="method get">GET</span>
                <strong>List Internships with Pagination</strong><br>
                <a href="http://127.0.0.1:5000/api/internships/?page=1&per_page=5" target="_blank"
                    style="color: #2980b9; text-decoration: underline;">http://127.0.0.1:5000/api/internships/?page=1&per_page=5</a>
                <p style="margin-top: 10px; color: #666; font-size: 14px;">List internships with pagination</p>
            </div>

            <div class="endpoint">
                <span class="method get">GET</span>
                <strong>Get Internship by ID</strong><br>
                <a href="http://127.0.0.1:5000/api/internships/1" target="_blank"
                    style="color: #2980b9; text-decoration: underline;">http://127.0.0.1:5000/api/internships/1</a>
                <p style="margin-top: 10px; color: #666; font-size: 14px;">Get internship by ID</p>
            </div>
        </div>

        <!-- Authentication -->
        <div class="section">
            <h2>🔐 Authentication (Phase 2)</h2>

            <div class="endpoint">
                <span class="method post">POST</span>
                <strong>Register Student</strong>
                <div class="form-group">
                    <input type="email" id="studentEmail" placeholder="Email" value="ahmed@student.com">
                    <input type="text" id="studentName" placeholder="Full Name" value="Ahmed Hassan">
                    <input type="password" id="studentPassword" placeholder="Password" value="password123">
                    <input type="text" id="studentUniversity" placeholder="University" value="Cairo University">
                    <input type="text" id="studentMajor" placeholder="Major" value="Computer Science">
                    <button onclick="registerStudent()">Register Student</button>
                </div>
            </div>

            <div class="endpoint">
                <span class="method post">POST</span>
                <strong>Register Company</strong>
                <div class="form-group">
                    <input type="email" id="companyEmail" placeholder="Email" value="hr@techcorp.com">
                    <input type="text" id="companyContactName" placeholder="Contact Name" value="HR Manager">
                    <input type="password" id="companyPassword" placeholder="Password" value="password123">
                    <input type="text" id="companyName" placeholder="Company Name" value="Tech Corp Egypt">
                    <input type="text" id="companyLocation" placeholder="Location" value="Cairo">
                    <button onclick="registerCompany()">Register Company</button>
                </div>
            </div>

            <div class="endpoint">
                <span class="method post">POST</span>
                <strong>Login</strong>
                <div class="form-group">
                    <input type="email" id="loginEmail" placeholder="Email" value="ahmed@student.com">
                    <input type="password" id="loginPassword" placeholder="Password" value="password123">
                    <button onclick="login()">Login & Get Token</button>
                </div>
            </div>

            <div class="endpoint">
                <span class="method get">GET</span>
                <button onclick="getCurrentUser()">Get Current User Info</button>
            </div>

            <div id="authResponse" class="response" style="display:none;"></div>
        </div>

        <!-- User Profile -->
        <div class="section">
            <h2>👤 User Profile (Phase 3.1 & 3.2)</h2>

            <div class="endpoint">
                <span class="method get">GET</span>
                <button onclick="getProfile()">Get My Profile</button>
            </div>

            <div class="endpoint">
                <span class="method put">PUT</span>
                <strong>Update Student Profile</strong>
                <div class="form-group">
                    <input type="text" id="profileSkills" placeholder="Skills (comma separated)"
                        value="Python, Flask, MySQL, React, JavaScript">
                    <input type="text" id="profileInterests" placeholder="Interests"
                        value="Web Development, Backend, AI">
                    <textarea id="profileBio" placeholder="Bio"
                        rows="3">Passionate computer science student interested in backend development and building scalable systems.</textarea>
                    <input type="text" id="profilePhone" placeholder="Phone" value="+20 123 456 7890">
                    <button onclick="updateProfile()">Update Profile</button>
                </div>
            </div>

            <div id="profileResponse" class="response" style="display:none;"></div>
        </div>

        <!-- Internships -->
        <div class="section">
            <h2>💼 Internships Management (Phase 3.3)</h2>

            <div class="info-box">
                <strong>Note:</strong> Login as a <strong>company</strong> to create/manage internships
            </div>

            <div class="endpoint">
                <span class="method get">GET</span>
                <button onclick="getAllInternships()">Get All Active Internships (Public)</button>
            </div>

            <div class="endpoint">
                <span class="method post">POST</span>
                <strong>Create Internship (Company Only)</strong>
                <div class="form-group">
                    <input type="text" id="internTitle" placeholder="Title" value="Backend Developer Intern">
                    <textarea id="internDesc" placeholder="Description"
                        rows="3">Work on Flask APIs, database design, and backend systems. Great opportunity to learn modern web development.</textarea>
                    <input type="text" id="internReq" placeholder="Requirements (comma separated)"
                        value="Python, Flask, MySQL, Git">
                    <input type="text" id="internLoc" placeholder="Location" value="Cairo">
                    <input type="text" id="internDur" placeholder="Duration" value="3 months">
                    <input type="text" id="internStipend" placeholder="Stipend" value="3000 EGP/month">
                    <label>Application Deadline:</label>
                    <input type="date" id="internDeadline" value="2025-12-31">
                    <label>Start Date:</label>
                    <input type="date" id="internStart" value="2026-01-15">
                    <button onclick="createInternship()">Create Internship</button>
                </div>
            </div>

            <div class="endpoint">
                <span class="method get">GET</span>
                <button onclick="getMyInternships()">Get My Internships (Company)</button>
            </div>

            <div id="internshipResponse" class="response" style="display:none;"></div>
        </div>

        <!-- Applications -->
        <div class="section">
            <h2>📝 Applications Workflow (Phase 3.4)</h2>

            <div class="endpoint">
                <span class="method post">POST</span>
                <strong>Apply for Internship (Student Only)</strong>
                <div class="form-group">
                    <input type="number" id="applyInternId" placeholder="Internship ID" value="1">
                    <textarea id="applyCover" placeholder="Cover Letter"
                        rows="4">Dear Hiring Manager,

I am very interested in this internship position. My skills in Python and Flask align well with your requirements, and I am eager to contribute to your team.</textarea>
                    <input type="text" id="applyResume" placeholder="Resume URL"
                        value="https://drive.google.com/resume">
                    <button onclick="applyForInternship()">Submit Application</button>
                </div>
            </div>

            <div class="endpoint">
                <span class="method get">GET</span>
                <button onclick="getMyApplications()">Get My Applications (Student)</button>
            </div>

            <div class="endpoint">
                <span class="method get">GET</span>
                <strong>View Applications for Internship (Company)</strong>
                <div class="form-group">
                    <input type="number" id="viewAppsInternId" placeholder="Internship ID" value="1">
                    <button onclick="getInternshipApplications()">View Applications</button>
                </div>
            </div>

            <div class="endpoint">
                <span class="method put">PUT</span>
                <strong>Update Application Status (Company)</strong>
                <div class="form-group">
                    <input type="number" id="statusAppId" placeholder="Application ID">
                    <select id="appStatus">
                        <option value="pending">Pending</option>
                        <option value="accepted">Accepted</option>
                        <option value="rejected">Rejected</option>
                        <option value="withdrawn">Withdrawn</option>
                    </select>
                    <button onclick="updateApplicationStatus()">Update Status</button>
                </div>
            </div>

            <div id="applicationResponse" class="response" style="display:none;"></div>
        </div>

        <!-- Recommendations (Phase 4) -->
        <div class="section" style="border: 3px solid #e74c3c;">
            <h2>🎯 Smart Recommendations (Phase 4)</h2>

            <div class="success-box">
                <strong>✨ Intelligent Matching System</strong><br>
                Get personalized internship recommendations based on your skills, major, location, and availability!
            </div>

            <div class="endpoint">
                <span class="method get">GET</span>
                <strong>Get Personalized Recommendations (Student Only)</strong>
                <div class="form-group">
                    <label>Minimum Match Score (0-100):</label>
                    <input type="number" id="minScore" placeholder="Minimum Score (optional)" value="0" min="0"
                        max="100">
                    <label>Maximum Results:</label>
                    <input type="number" id="maxResults" placeholder="Limit (optional)" value="10" min="1" max="50">
                    <button onclick="getRecommendations()">🎯 Get Recommendations</button>
                </div>
            </div>

            <div class="endpoint">
                <span class="method get">GET</span>
                <button onclick="testMatchingSystem()">🧪 Test Matching System</button>
            </div>

            <div class="info-box">
                <strong>How it works:</strong><br>
                • <strong>Skills Match (40%):</strong> Compares your skills with internship requirements<br>
                • <strong>Major Match (30%):</strong> Matches your major with internship field<br>
                • <strong>Location Match (15%):</strong> Considers location preferences<br>
                • <strong>Availability Match (15%):</strong> Checks time availability<br>
                <br>
                <strong>Total Score:</strong> 0-100 (higher = better match)
            </div>

            <div id="recommendationResponse" class="response" style="display:none;"></div>
        </div>

        <!-- PHASE 5: CV Upload -->
        <div class="section" style="border: 3px solid #9b59b6;">
            <h2>📄 CV Upload & Storage (Phase 5)</h2>

            <div class="endpoint">
                <span class="method post">POST</span>
                <strong>Upload CV (Student Only)</strong><br>
                <input type="file" id="cvFile" accept=".pdf,.doc,.docx" style="margin: 10px 0;">
                <button onclick="uploadCV()">📤 Upload CV</button>
                <p style="margin-top: 10px; color: #666; font-size: 14px;">
                    Supported formats: PDF, DOC, DOCX | Max size: 5MB
                </p>
            </div>

            <div id="cvResponse" class="response" style="display:none;"></div>
        </div>

        <!-- PHASE 5: Admin Dashboard -->
        <div class="section" style="border: 3px solid #e74c3c;">
            <h2>👥 Admin Dashboard (Phase 5)</h2>

            <div class="endpoint">
                <span class="method get">GET</span>
                <strong>System Statistics</strong><br>
                <button onclick="getAdminStats()">📊 Get Stats</button>
                <p style="margin-top: 10px; color: #666; font-size: 14px;">
                    View comprehensive system statistics (Admin only)
                </p>
            </div>

            <div class="endpoint">
                <span class="method get">GET</span>
                <strong>Pending Companies</strong><br>
                <button onclick="getPendingCompanies()">📋 View Pending</button>
                <p style="margin-top: 10px; color: #666; font-size: 14px;">
                    List companies awaiting verification
                </p>
            </div>

            <div class="endpoint">
                <span class="method post">POST</span>
                <strong>Approve Company</strong><br>
                <input type="number" id="approveCompanyId" placeholder="Company ID" style="width: 200px;">
                <button onclick="approveCompany()">✅ Approve</button>
            </div>

            <div id="adminResponse" class="response" style="display:none;"></div>
        </div>

        <!-- PHASE 5: Chatbot -->
        <div class="section" style="border: 3px solid #1abc9c;">
            <h2>🤖 Chatbot (Phase 5)</h2>

            <div class="endpoint">
                <span class="method post">POST</span>
                <strong>Chat with Bot</strong><br>
                <input type="text" id="chatMessage" placeholder="Ask me anything..." style="width: 400px;">
                <button onclick="chatWithBot()">💬 Send</button>
                <p style="margin-top: 10px; color: #666; font-size: 14px;">
                    Try: "How do I register?", "How can I apply?", "How do I upload my CV?"
                </p>
            </div>

            <div class="endpoint">
                <span class="method get">GET</span>
                <strong>View All FAQs</strong><br>
                <button onclick="getAllFAQs()">📚 Get FAQs</button>
            </div>

            <div id="chatbotResponse" class="response" style="display:none;"></div>
        </div>

        <!-- API Documentation -->
        <div class="section">
            <h2>📚 API Documentation</h2>
            <div class="grid">
                <div class="card">
                    <h3>✅ Phase 1: Foundation</h3>
                    <p>Backend setup, project structure, database connection</p>
                </div>
                <div class="card">
                    <h3>✅ Phase 2: Authentication</h3>
                    <p>User registration, login, JWT tokens, role-based access</p>
                </div>
                <div class="card">
                    <h3>✅ Phase 3: Business Logic</h3>
                    <p>Profiles, internships CRUD, application workflow</p>
                </div>
                <div class="card">
                    <h3>✅ Phase 4: Matching System</h3>
                    <p>Intelligent recommendations, score calculation</p>
                </div>
                <div class="card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                    <h3>✅ Phase 5: Advanced Features</h3>
                    <p>CV Upload, Admin Dashboard, Chatbot</p>
                </div>
                <div class="card" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white;">
                    <h3>✅ Phase 6: Quality & Delivery</h3>
                    <p>Validation, Error Handling, Swagger Docs, Testing</p>
                </div>
            </div>

            <!-- Swagger Documentation Link -->
            <div class="success-box" style="margin-top: 20px;">
                <strong>📖 Swagger API Documentation:</strong><br>
                <a href="http://127.0.0.1:5000/apidocs" target="_blank" style="color: #2980b9; font-weight: bold;">
                    http://127.0.0.1:5000/apidocs
                </a>
                <p style="margin-top: 10px; color: #666;">
                    Interactive API documentation with Swagger UI - Test all endpoints directly!
                </p>
            </div>
        </div>
    </div>

    <script>
        const BASE_URL = 'http://127.0.0.1:5000';
        let authToken = null;
        let currentUser = null;

        function showResponse(elementId, data) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.textContent = JSON.stringify(data, null, 2);
            element.scrollTop = 0;
        }

        function updateTokenDisplay() {
            if (authToken && currentUser) {
                document.getElementById('tokenInfo').style.display = 'block';
                document.getElementById('tokenValue').textContent = authToken.substring(0, 60) + '...';
                document.getElementById('userInfo').textContent =
                    `Logged in as: ${currentUser.name} (${currentUser.role}) - ID: ${currentUser.id}`;
            }
        }

        async function registerStudent() {
            try {
                const response = await fetch(`${BASE_URL}/api/auth/register/student`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: document.getElementById('studentEmail').value,
                        name: document.getElementById('studentName').value,
                        password: document.getElementById('studentPassword').value,
                        university: document.getElementById('studentUniversity').value,
                        major: document.getElementById('studentMajor').value
                    })
                });
                const data = await response.json();
                showResponse('authResponse', data);

                if (data.message && data.user) {
                    alert('✅ Student Account Created!\nYou can now login with your credentials.');
                } else if (data.error) {
                    alert('❌ Registration Failed: ' + data.error);
                }
            } catch (error) {
                alert('❌ Error: ' + error.message);
                showResponse('authResponse', { error: error.message });
            }
        }

        async function registerCompany() {
            try {
                const response = await fetch(`${BASE_URL}/api/auth/register/company`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: document.getElementById('companyEmail').value,
                        name: document.getElementById('companyContactName').value,
                        password: document.getElementById('companyPassword').value,
                        company_name: document.getElementById('companyName').value,
                        company_location: document.getElementById('companyLocation').value
                    })
                });
                const data = await response.json();
                showResponse('authResponse', data);

                if (data.message && data.user) {
                    alert('✅ Company Account Created!\nYou can now login with your credentials.');
                } else if (data.error) {
                    alert('❌ Registration Failed: ' + data.error);
                }
            } catch (error) {
                alert('❌ Error: ' + error.message);
                showResponse('authResponse', { error: error.message });
            }
        }

        async function login() {
            try {
                const response = await fetch(`${BASE_URL}/api/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: document.getElementById('loginEmail').value,
                        password: document.getElementById('loginPassword').value
                    })
                });
                const data = await response.json();
                showResponse('authResponse', data);

                if (data.access_token) {
                    authToken = data.access_token;
                    currentUser = data.user;
                    updateTokenDisplay();
                    alert(`✅ Login Successful!\nWelcome ${data.user.name} (${data.user.role})`);
                } else if (data.error) {
                    alert('❌ Login Failed: ' + data.error);
                }
            } catch (error) {
                alert('❌ Error: ' + error.message);
                showResponse('authResponse', { error: error.message });
            }
        }

        async function getCurrentUser() {
            if (!authToken) {
                alert('⚠️ Please login first!');
                return;
            }
            try {
                const response = await fetch(`${BASE_URL}/api/auth/me`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const data = await response.json();
                showResponse('authResponse', data);
            } catch (error) {
                showResponse('authResponse', { error: error.message });
            }
        }

        async function getProfile() {
            if (!authToken) {
                alert('⚠️ Please login first!');
                return;
            }
            try {
                const response = await fetch(`${BASE_URL}/api/users/profile`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const data = await response.json();
                showResponse('profileResponse', data);
            } catch (error) {
                showResponse('profileResponse', { error: error.message });
            }
        }

        async function updateProfile() {
            if (!authToken) {
                alert('⚠️ Please login first!');
                return;
            }
            try {
                const response = await fetch(`${BASE_URL}/api/users/profile`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        skills: document.getElementById('profileSkills').value,
                        interests: document.getElementById('profileInterests').value,
                        bio: document.getElementById('profileBio').value,
                        phone: document.getElementById('profilePhone').value
                    })
                });
                const data = await response.json();
                showResponse('profileResponse', data);
                if (data.message) {
                    alert('✅ Profile updated successfully!');
                }
            } catch (error) {
                showResponse('profileResponse', { error: error.message });
            }
        }

        async function getAllInternships() {
            try {
                const response = await fetch(`${BASE_URL}/api/internships/`);
                const data = await response.json();
                showResponse('internshipResponse', data);
            } catch (error) {
                showResponse('internshipResponse', { error: error.message });
            }
        }

        async function createInternship() {
            if (!authToken) {
                alert('⚠️ Please login as company first!');
                return;
            }
            try {
                const response = await fetch(`${BASE_URL}/api/internships/`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        title: document.getElementById('internTitle').value,
                        description: document.getElementById('internDesc').value,
                        requirements: document.getElementById('internReq').value,
                        location: document.getElementById('internLoc').value,
                        duration: document.getElementById('internDur').value,
                        stipend: document.getElementById('internStipend').value,
                        application_deadline: document.getElementById('internDeadline').value,
                        start_date: document.getElementById('internStart').value
                    })
                });
                const data = await response.json();
                showResponse('internshipResponse', data);
                if (data.message) {
                    alert('✅ Internship created successfully!');
                }
            } catch (error) {
                showResponse('internshipResponse', { error: error.message });
            }
        }

        async function getMyInternships() {
            if (!authToken) {
                alert('⚠️ Please login as company first!');
                return;
            }
            try {
                const response = await fetch(`${BASE_URL}/api/internships/my`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const data = await response.json();
                showResponse('internshipResponse', data);
            } catch (error) {
                showResponse('internshipResponse', { error: error.message });
            }
        }

        async function applyForInternship() {
            if (!authToken) {
                alert('⚠️ Please login as student first!');
                return;
            }
            try {
                const response = await fetch(`${BASE_URL}/api/applications/apply`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        internship_id: parseInt(document.getElementById('applyInternId').value),
                        cover_letter: document.getElementById('applyCover').value,
                        resume_url: document.getElementById('applyResume').value
                    })
                });
                const data = await response.json();
                showResponse('applicationResponse', data);
                if (data.message) {
                    alert('✅ Application submitted successfully!');
                }
            } catch (error) {
                showResponse('applicationResponse', { error: error.message });
            }
        }

        async function getMyApplications() {
            if (!authToken) {
                alert('⚠️ Please login as student first!');
                return;
            }
            try {
                const response = await fetch(`${BASE_URL}/api/applications/my`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const data = await response.json();
                showResponse('applicationResponse', data);
            } catch (error) {
                showResponse('applicationResponse', { error: error.message });
            }
        }

        async function getInternshipApplications() {
            if (!authToken) {
                alert('⚠️ Please login as company first!');
                return;
            }
            const internId = document.getElementById('viewAppsInternId').value;
            try {
                const response = await fetch(`${BASE_URL}/api/applications/internship/${internId}`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const data = await response.json();
                showResponse('applicationResponse', data);
            } catch (error) {
                showResponse('applicationResponse', { error: error.message });
            }
        }

        async function updateApplicationStatus() {
            if (!authToken) {
                alert('⚠️ Please login as company first!');
                return;
            }
            const appId = document.getElementById('statusAppId').value;
            const status = document.getElementById('appStatus').value;
            try {
                const response = await fetch(`${BASE_URL}/api/applications/${appId}/status`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ status: status })
                });
                const data = await response.json();
                showResponse('applicationResponse', data);
                if (data.message) {
                    alert('✅ Application status updated!');
                }
            } catch (error) {
                showResponse('applicationResponse', { error: error.message });
            }
        }

        // NEW: Recommendations Functions
        async function getRecommendations() {
            if (!authToken) {
                alert("⚠️ Please login as student first!");
                return;
            }

            try {
                const minScore = document.getElementById('minScore').value;
                const limit = document.getElementById('maxResults').value;

                let url = `${BASE_URL}/api/recommendations`;
                const params = [];
                if (minScore && minScore > 0) params.push(`min_score=${minScore}`);
                if (limit) params.push(`limit=${limit}`);
                if (params.length > 0) url += '?' + params.join('&');

                const response = await fetch(url, {
                    headers: {
                        "Authorization": `Bearer ${authToken}`
                    }
                });

                const data = await response.json();
                showResponse("recommendationResponse", data);

                if (data.recommendations && data.recommendations.length > 0) {
                    alert(`✅ Found ${data.total} recommendations!\nTop match score: ${data.recommendations[0].score}`);
                } else if (data.message) {
                    alert('ℹ️ ' + data.message);
                }
            } catch (error) {
                showResponse("recommendationResponse", { error: error.message });
                alert('❌ Error: ' + error.message);
            }
        }

        async function testMatchingSystem() {
            if (!authToken) {
                alert("⚠️ Please login as student first!");
                return;
            }

            try {
                const response = await fetch(`${BASE_URL}/api/recommendations/test`, {
                    headers: {
                        "Authorization": `Bearer ${authToken}`
                    }
                });

                const data = await response.json();
                showResponse("recommendationResponse", data);
                alert('✅ Matching system is working!\nCheck the response below for details.');
            } catch (error) {
                showResponse("recommendationResponse", { error: error.message });
                alert('❌ Error: ' + error.message);
            }
        }

        // ========== PHASE 5: CV Upload Functions ==========

        async function uploadCV() {
            if (!authToken) {
                alert('⚠️ Please login as student first!');
                return;
            }

            const fileInput = document.getElementById('cvFile');
            const file = fileInput.files[0];

            if (!file) {
                alert('⚠️ Please select a CV file first!');
                return;
            }

            // Check file size (5MB = 5 * 1024 * 1024 bytes)
            if (file.size > 5 * 1024 * 1024) {
                alert('❌ File too large! Maximum size is 5MB.');
                return;
            }

            // Check file type
            const allowedTypes = ['.pdf', '.doc', '.docx'];
            const fileName = file.name.toLowerCase();
            const isAllowed = allowedTypes.some(type => fileName.endsWith(type));

            if (!isAllowed) {
                alert('❌ Invalid file type! Only PDF, DOC, and DOCX are allowed.');
                return;
            }

            try {
                const formData = new FormData();
                formData.append('cv', file);

                const response = await fetch(`${BASE_URL}/api/users/upload-cv`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: formData
                });

                const data = await response.json();
                showResponse('cvResponse', data);

                if (data.message) {
                    alert('✅ CV uploaded successfully!\\nFile: ' + file.name);
                    fileInput.value = ''; // Clear file input
                } else if (data.error) {
                    alert('❌ Upload failed: ' + data.error);
                }
            } catch (error) {
                showResponse('cvResponse', { error: error.message });
                alert('❌ Error: ' + error.message);
            }
        }

        // ========== PHASE 5: Admin Dashboard Functions ==========

        async function getAdminStats() {
            if (!authToken) {
                alert('⚠️ Please login as admin first!');
                return;
            }

            // Check if user is admin
            if (currentUser && currentUser.role !== 'admin') {
                alert('❌ Access Denied\n\nOnly administrators can view statistics.\n\nYour Role: ' + currentUser.role + '\nRequired: admin');
                return;
            }

            try {
                const response = await fetch(`${BASE_URL}/api/admin/stats`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const data = await response.json();
                showResponse('adminResponse', data);

                if (data.users) {
                    alert('Statistics loaded!\n\nTotal Users: ' + data.users.total +
                        '\nTotal Internships: ' + data.internships.total +
                        '\nTotal Applications: ' + data.applications.total);
                } else if (data.error) {
                    let errorMsg = '❌ ' + data.error;
                    if (data.message) errorMsg += '\n\n' + data.message;
                    if (data.your_role) errorMsg += '\n\nYour Role: ' + data.your_role;
                    if (data.required_roles) errorMsg += '\nRequired: ' + data.required_roles.join(', ');
                    alert(errorMsg);
                }
            } catch (error) {
                showResponse('adminResponse', { error: error.message });
                alert('❌ Error: ' + error.message);
            }
        }

        async function getPendingCompanies() {
            if (!authToken) {
                alert('⚠️ Please login as admin first!');
                return;
            }

            // Check if user is admin
            if (currentUser && currentUser.role !== 'admin') {
                alert('❌ Access Denied\n\nOnly administrators can view pending companies.\n\nYour Role: ' + currentUser.role + '\nRequired: admin');
                return;
            }

            try {
                const response = await fetch(`${BASE_URL}/api/admin/companies/pending`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const data = await response.json();
                showResponse('adminResponse', data);

                if (data.companies) {
                    alert(`✅ Found ${data.total} pending companies!`);
                } else if (data.error) {
                    let errorMsg = '❌ ' + data.error;
                    if (data.message) errorMsg += '\n\n' + data.message;
                    if (data.your_role) errorMsg += '\n\nYour Role: ' + data.your_role;
                    if (data.required_roles) errorMsg += '\nRequired: ' + data.required_roles.join(', ');
                    alert(errorMsg);
                }
            } catch (error) {
                showResponse('adminResponse', { error: error.message });
                alert('❌ Error: ' + error.message);
            }
        }

        async function approveCompany() {
            if (!authToken) {
                alert('⚠️ Please login as admin first!');
                return;
            }

            // Check if user is admin
            if (currentUser && currentUser.role !== 'admin') {
                alert('❌ Access Denied\n\nOnly administrators can approve companies.\n\nYour Role: ' + currentUser.role + '\nRequired: admin');
                return;
            }

            const companyId = document.getElementById('approveCompanyId').value;

            if (!companyId) {
                alert('⚠️ Please enter a company ID!');
                return;
            }

            try {
                const response = await fetch(`${BASE_URL}/api/admin/companies/${companyId}/approve`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const data = await response.json();
                showResponse('adminResponse', data);

                if (data.message) {
                    alert('✅ Company approved successfully!');
                    document.getElementById('approveCompanyId').value = '';
                } else if (data.error) {
                    let errorMsg = '❌ ' + data.error;
                    if (data.message) errorMsg += '\n\n' + data.message;
                    if (data.your_role) errorMsg += '\n\nYour Role: ' + data.your_role;
                    if (data.required_roles) errorMsg += '\nRequired: ' + data.required_roles.join(', ');
                    alert(errorMsg);
                }
            } catch (error) {
                showResponse('adminResponse', { error: error.message });
                alert('❌ Error: ' + error.message);
            }
        }

        // ========== PHASE 5: Chatbot Functions ==========

        async function chatWithBot() {
            const message = document.getElementById('chatMessage').value.trim();

            if (!message) {
                alert('⚠️ Please enter a message!');
                return;
            }

            try {
                const response = await fetch(`${BASE_URL}/api/chatbot/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ message: message })
                });
                const data = await response.json();
                showResponse('chatbotResponse', data);

                if (data.response) {
                    alert('🤖 Bot: ' + data.response);
                } else if (data.error) {
                    alert('❌ Error: ' + data.error);
                }
            } catch (error) {
                showResponse('chatbotResponse', { error: error.message });
                alert('❌ Error: ' + error.message);
            }
        }

        async function getAllFAQs() {
            try {
                const response = await fetch(`${BASE_URL}/api/chatbot/faq`);
                const data = await response.json();
                showResponse('chatbotResponse', data);

                if (data.faqs) {
                    alert(`✅ Found ${data.total} FAQ categories!\\nCheck the response below for details.`);
                } else if (data.error) {
                    alert('❌ Error: ' + data.error);
                }
            } catch (error) {
                showResponse('chatbotResponse', { error: error.message });
                alert('❌ Error: ' + error.message);
            }
        }

    </script>
</body>

</html>